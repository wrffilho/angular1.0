<!--

Diretivas são extensões da linguagem HTMl que permitem a implementação de novos comportamentos, de forma declarativa

ngApp - define as fronteiras da aplicação, o angular percorre o html procurando por essas diretivas

ngController - vincula um elemento da view ao Controller
-->

<!DOCTYPE html>
<html ng-app="listaTelefonica">
<head>
	<title>Lista Telefonica</title>
	<link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.css">
	<style>
		.jumbotron {
			width: 500px;
			margin-top: 10px;
			margin-left: auto;
			margin-right: auto;
			border-radius:  10px 20px;
			border: solid 3px;
			border-color: #52A3F9;
		}
		.jumbotron h3 {
			margin-bottom: 30px;
			text-align: center;
		}
		.table {
			margin-top: 20px;
		}
		.form-control {
			margin-bottom: 5px;
		}
		.selecionado {
			background-color: yellow;
		}
		.negrito {
			font-weight: bold;
		}

		.btn{
			margin-bottom: 5px;
		}

		.alert{
			margin-top: 10px;
		}
	</style>
	<meta charset="utf-8">
	<script src="lib/angular/angular.js"></script>
	<script src="lib/angular/angular-messages.js"></script>
	<script>
		//[]-- é conjunto de modulos que se pode importar, está trazendos todos componentes
		angular.module("listaTelefonica",["ngMessages"]);
		angular.module("listaTelefonica").controller("listaTelefonicaCtrl", function($scope){
			$scope.app="Lista Telefônica";
			$scope.contatos = [
				{nome:"Wanderlei", telefone:"98408-8408", cor: "red"},
				{nome:"Aline", telefone:"98413-8381", cor:"blue"},
				{nome:"Zuleide", telefone:"99400-2911", cor:"green"}
				];
			$scope.operadoras = [
				{nome: "Claro", codigo: 21, categoria: "Celular"},
				{nome: "Tim", codigo: 41, categoria: "Celular"},
				{nome: "Oi", codigo: 14, categoria: "Celular"},
				{nome: "Vivo", codigo: 15, categoria: "Celular"},
				{nome: "GVT", codigo: 15, categoria: "Fixo"},
				{nome: "Embratel", codigo: 15, categoria: "Fixo"}

			];

			//

			$scope.adicionarContato = function(contato){
					
			//evitar ler parametros dentro do controller
			//*$scope.contatos.push({nome: $scope.nome, telefone: $scope.telefone});*/
			//forma correta
			//$scope.contatos.push(nome, telefone);
			// forma mais correta
			//$scope.contatos.push(contato);
			//para não alterar 
			//$scope.contatos.push(angular.copy(contato));
			//pode ser feito assim
			$scope.contatos.push(contato);
			delete $scope.contato;
			$scope.contatoForm.$setPristine();
			};
			
			$scope.apagarContatos = function(contatos){
				$scope.contatos = contatos.filter(function(contato){
					if(!contato.selecionado){
						return contato;
					}
				});
			};

			$scope.isContatoSelecionado = function(contatos){
				return contatos.some(function(contato){
					return (contato.selecionado);
				});

			};
		});

	</script>
</head>

<!--ngController - faz o vinculo entre a view e controller 
    ng-Bind substitui o elemento por uma expressão,  pega uma coisa do $scope e exibe
 	ngRepeat para iterar sobre os itens de uma coleção ou de um objeto
 	ng-model pega uma coisa da view e define no scope, aplicados nos inputs selcts e nos texts area
 	ngClick atribui um comportamento ao evento
 	ng_options renderizar opções do select
	ngClass e ngstyle ->>  aplicando classe CSS e estilos dinamicamentes
	ngShow/ngHide/ngIf ->> exibindo um elemento condicionalmente
	ngRequired ->> define um determiando campo como obrigatório
	$prestine e $dirty verificando se  um formulário já foi utilizado alguma vez
	ngMinlength e ngMaxLength define o tamanho minimo e maximo permitido
	$error consultando os erros de um campo ou formulário
	ngPattern define uma expressão regular (RegExp) para validar um campo
	date formata data usando uma mascara
	filter-> filtra um array com base em um critério
	orderBy -> Ordena um array com base em um critério


 -->

<body ng-controller = "listaTelefonicaCtrl">
	
	<div class="jumbotron">
		<h3 ng-bind="app"></h3>
		<!--{{app}} é uma outra forma de exibir o conteudo-->
		<table ng-show="contatos.length > 0" class="table table-striped">
			<tr>
				<th></th>
				<th>Nome</th>
				<th>Telefone</th>
				<th>Operadora</th>
				<th>Status</th>
			</tr>
			<tr ng-class="{selecionado: contato.selecionado, negrito: contato.selecionado}" ng-repeat="contato in contatos">
				<!--pode ser feito assim
					<tr ng-class="{'selecionado negrito':contato.selecionado}" ng-repeat="contato in contatos">-->
				<td><input  type="checkbox" ng-model="contato.selecionado"></td>
				<td>{{contato.nome | uppercase}}</td>
				<td>{{contato.telefone}}</td>
				<td>{{contato.operadora.nome | lowercase}}</td>
				<!--<td>{{contato.operadora.nome | lowercase}}</td>-->
				<td><div style="width: 20px; height: 20px;" ng-style="{'background-color': contato.cor}"></div></td>
				


			<!--outra forma de ler o array 
			<tr ng-repeat = "(key, value) in contato">
							{{key + '-' + value}} -->			
			</tr>
		</table>
		<br/>
		<hr/>
		<form name="contatoForm">
			<input class="form-control" type="text" ng-model="contato.nome" placeholder="Nome" ng-required="true" name="nome"  ng-minlength="10"/>
			<input class= "form-control" type="text" ng-model="contato.telefone" placeholder="Telefone" ng-required="true" name="telefone"/>
			<select class= "form-control" ng-model="contato.operadora" ng-options="operadora.nome group by operadora.categoria for operadora in operadoras" name="sOperadora" ng-required = "true">
				<option value="">Selecione uma operadora</option>
			</select>
		</form>

		<div ng-messages="contatoForm.nome.$error" class="alert alert-danger">
			<div ng-message="required">
				Por favor, preencha o campo nome!
			</div>
			<div ng-message="minlength">
				O campo nome deve ter no mínimo 10 caracteres.
			</div>
		</div>
		<div ng-show="contatoForm.telefone.$error.required && contatoForm.telefone.$dirty" class="alert alert-danger">
			Por favor, preencha o campo telefone!
		</div>
		<div ng-show="contatoForm.telefone.$error.pattern" class="alert alert-danger">
			O campo telefone deve ter o formato DDDDD-DDDD.
		</div>
		<button class="btn btn-primary btn-block" ng-click="adicionarContato(contato)" ng-disabled ="contatoForm.$invalid">Adicionar Contato</button>
		<button class="btn btn-danger btn-block" ng-click="apagarContatos(contatos)" ng-if ="isContatoSelecionado(contatos)">Apagar Contatos</button>
		<!--two way databind, o compilador percorre todos elementos que tenham diretivas e qndo encontra uma diretica do tipo ng model ele começa a escutar e cada vez que vc aperta a tecla ele atualiza o scope 
		
		Filtros -- transformam resultados de uma expressão, realizando operações como a formatação de dataa conversão da moeda e aordenação de Array

		-->
		<div ng-show="contatoForm.sOperadora.$invalid && contatoForm.sOperadora.$dirty" class="alert alert-danger">Por favor, selecione uma operadora!</div>
	</div>
	<div ng-include="'footer.html'">teste</div>

</body>
</html>